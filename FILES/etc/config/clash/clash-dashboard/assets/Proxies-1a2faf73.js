import{r as _,R as z,P as k,c as L,N as ye,j as s,B as v,h as y,O as me,Q as fe,T as Q,U as J,d as b,V as je,W as _e,X as ee,Y as R,w as $,Z as ve,_ as te,$ as A,a0 as se,a1 as E,a2 as H,a3 as ge,a4 as be,u as U,a5 as we,a6 as Ce,a7 as Pe,g as ne,C as re,x as K,a8 as ke,a9 as Se,aa as Ne,ab as Ae,ac as Le}from"./index-dcea5d2f.js";import{C as $e,B as V}from"./BaseModal-29d7cf7b.js";import{F as Oe,p as Te,A as Be,I as De}from"./Fab-8003d842.js";import{R as Fe,a as Ie,T as Re}from"./TextFilter-5cf71eda.js";import{f as Ee}from"./index-759f7e71.js";import{S as He}from"./Select-29e929fc.js";import"./debounce-c1ba2006.js";function I(){return I=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},I.apply(this,arguments)}function Ue(e,t){if(e==null)return{};var n=qe(e,t),r,o;if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)r=a[o],!(t.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}function qe(e,t){if(e==null)return{};var n={},r=Object.keys(e),o,a;for(a=0;a<r.length;a++)o=r[a],!(t.indexOf(o)>=0)&&(n[o]=e[o]);return n}var q=_.forwardRef(function(e,t){var n=e.color,r=n===void 0?"currentColor":n,o=e.size,a=o===void 0?24:o,c=Ue(e,["color","size"]);return z.createElement("svg",I({ref:t,xmlns:"http://www.w3.org/2000/svg",width:a,height:a,viewBox:"0 0 24 24",fill:"none",stroke:r,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},c),z.createElement("polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2"}))});q.propTypes={color:k.string,size:k.oneOfType([k.string,k.number])};q.displayName="Zap";const W=q;function oe(e){const t=e.size||24,n=L({[ye.animate]:e.animate});return s.jsx("svg",{className:n,xmlns:"http://www.w3.org/2000/svg",width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:s.jsx("polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2"})})}const Me="_FlexCenter_1380a_1",ze={FlexCenter:Me};function Ke({children:e}){return s.jsx("div",{className:ze.FlexCenter,children:e})}const{useRef:Z,useEffect:Ve}=y;function We({onClickPrimaryButton:e,onClickSecondaryButton:t}){const n=Z(null),r=Z(null);Ve(()=>{n.current.focus()},[]);const o=a=>{a.code==="ArrowRight"?r.current.focus():a.code==="ArrowLeft"&&n.current.focus()};return s.jsxs("div",{onKeyDown:o,children:[s.jsx("h2",{children:"Close Connections?"}),s.jsx("p",{children:"Click [Yes] to close those connections that are still using the old selected proxy in this group"}),s.jsx("div",{style:{height:30}}),s.jsxs(Ke,{children:[s.jsx(v,{onClick:e,ref:n,children:"Yes"}),s.jsx("div",{style:{width:20}}),s.jsx(v,{onClick:t,ref:r,children:"No"})]})]})}const Ze="_header_1y9js_1",Ge="_arrow_1y9js_8",Ye="_isOpen_1y9js_13",Xe="_btn_1y9js_20",Qe="_qty_1y9js_25",w={header:Ze,arrow:Ge,isOpen:Ye,btn:Xe,qty:Qe};function ae({name:e,type:t,toggle:n,isOpen:r,qty:o}){const a=_.useCallback(c=>{c.preventDefault(),(c.key==="Enter"||c.key===" ")&&n()},[n]);return s.jsxs("div",{className:w.header,onClick:n,style:{cursor:"pointer"},tabIndex:0,onKeyDown:a,role:"button",children:[s.jsx("div",{children:s.jsx(me,{name:e,type:t})}),typeof o=="number"?s.jsx("span",{className:w.qty,children:o}):null,s.jsx(v,{kind:"minimal",onClick:n,className:w.btn,title:"Toggle collapsible section",children:s.jsx("span",{className:L(w.arrow,{[w.isOpen]:r}),children:s.jsx($e,{size:20})})})]})}const{useMemo:Je}=y;function et(e,t){return e.filter(n=>{const r=t[n];return r===void 0?!0:r.number!==0})}const S=(e,t)=>{if(e&&typeof e.number=="number"&&e.number>0)return e.number;const n=t&&t.type;return n&&J.indexOf(n)>-1?-1:999999},tt={Natural:e=>e,LatencyAsc:(e,t,n)=>e.sort((r,o)=>{const a=S(t[r],n&&n[r]),c=S(t[o],n&&n[o]);return a-c}),LatencyDesc:(e,t,n)=>e.sort((r,o)=>{const a=S(t[r],n&&n[r]);return S(t[o],n&&n[o])-a}),NameAsc:e=>e.sort(),NameDesc:e=>e.sort((t,n)=>t>n?-1:t<n?1:0)};function st(e,t){const n=t.toLowerCase().split(" ").map(r=>r.trim()).filter(r=>!!r);return n.length===0?e:e.filter(r=>{let o=0;for(;o<n.length;o++){const a=n[o];if(r.toLowerCase().indexOf(a)>-1)return!0}return!1})}function nt(e,t,n,r,o,a){let c=[...e];return n&&(c=et(e,t)),typeof r=="string"&&r!==""&&(c=st(c,r)),tt[o](c,t,a)}function ce(e,t,n,r,o){const[a]=fe(Q);return Je(()=>nt(e,t,n,a,r,o),[e,t,n,a,r,o])}const rt="_header_5pmv2_1",ot="_groupHead_5pmv2_5",at="_action_5pmv2_11",B={header:rt,groupHead:ot,action:at},ct="_proxy_ryc3j_1",it="_now_ryc3j_25",lt="_error_ryc3j_29",ut="_selectable_ryc3j_32",dt="_proxyType_ryc3j_40",xt="_row_ryc3j_51",pt="_proxyName_ryc3j_57",ht="_proxySmall_ryc3j_66",h={proxy:ct,now:it,error:lt,selectable:ut,proxyType:dt,row:xt,proxyName:pt,proxySmall:ht},yt="_proxyLatency_pw0sa_1",mt={proxyLatency:yt};function ft({latency:e,color:t}){let n=" ";if(e)switch(e.kind){case"Error":case"Testing":n="- ms";break;case"Result":n=(e.number!==0?e.number:"-")+" ms";break}return s.jsx("span",{className:mt.proxyLatency,style:{color:t},children:n})}const{useMemo:P}=y,g={good:"#67c23a",normal:"#d4b75c",bad:"#e67f3c",na:"#909399"};function ie(e){if(!e||e.kind!=="Result")return g.na;const t=e.number;return t===0?g.na:t<200?g.good:t<400?g.normal:typeof t=="number"?g.bad:g.na}function jt(e,t){return J.indexOf(t)>-1?{border:"1px dotted #777"}:{background:ie(e)}}function _t({now:e,name:t,proxy:n,latency:r,isSelectable:o,onClick:a}){const c=P(()=>jt(r,n.type),[r,n]),i=P(()=>{let u=t;return r&&r.kind==="Result"&&typeof r.number=="number"&&(u+=" "+r.number+" ms"),u},[t,r]),l=_.useCallback(()=>{o&&a&&a(t)},[t,a,o]),d=P(()=>L(h.proxySmall,{[h.now]:e,[h.selectable]:o}),[o,e]),x=_.useCallback(u=>{u.key==="Enter"&&l()},[l]);return s.jsx("div",{title:i,className:d,style:c,onClick:l,onKeyDown:x,role:o?"menuitem":""})}function vt(e){return e==="Shadowsocks"?"SS":e}const gt=e=>({left:e.left+window.scrollX-5,top:e.top+window.scrollY-38});function bt({children:e,label:t,"aria-label":n}){const[r,o]=je();return s.jsxs(s.Fragment,{children:[_.cloneElement(e,r),s.jsx(_e,{...o,label:t,"aria-label":n,position:gt})]})}function wt({now:e,name:t,proxy:n,latency:r,isSelectable:o,onClick:a}){const c=P(()=>ie(r),[r]),i=_.useCallback(()=>{o&&a&&a(t)},[t,a,o]),l=_.useCallback(x=>{x.key==="Enter"&&i()},[i]),d=P(()=>L(h.proxy,{[h.now]:e,[h.selectable]:o}),[o,e]);return s.jsxs("div",{tabIndex:0,className:d,onClick:i,onKeyDown:l,role:o?"menuitem":"",children:[s.jsx("div",{className:h.proxyName,children:s.jsx(bt,{label:t,"aria-label":"proxy name: "+t,children:s.jsx("span",{children:t})})}),s.jsxs("div",{className:h.row,children:[s.jsx("span",{className:h.proxyType,style:{opacity:e?.6:.2},children:vt(n.type)}),s.jsx(ft,{latency:r,color:c})]})]})}const le=(e,{name:t})=>{const n=ee(e),r=R(e);return{proxy:n[t]||{name:t,type:"Unknown",history:[]},latency:r[t]}},Ct=b(le)(wt),Pt=b(le)(_t),kt="_list_1oy7w_1",St="_listSummaryView_1oy7w_8",ue={list:kt,listSummaryView:St};function de({all:e,now:t,isSelectable:n,itemOnTapCallback:r}){const o=e;return s.jsx("div",{className:ue.list,children:o.map(a=>s.jsx(Ct,{onClick:r,isSelectable:n,name:a,now:a===t},a))})}function xe({all:e,now:t,isSelectable:n,itemOnTapCallback:r}){return s.jsx("div",{className:ue.listSummaryView,children:e.map(o=>s.jsx(Pt,{onClick:r,isSelectable:n,name:o,now:o===t},o))})}const{createElement:Nt,useCallback:D,useMemo:At}=y;function Lt({name:e,all:t,delay:n,hideUnavailableProxies:r,proxySortBy:o,proxies:a,type:c,now:i,isOpen:l,apiConfig:d,dispatch:x}){const u=ce(t,n,r,o,a),f=At(()=>c==="Selector",[c]),{app:{updateCollapsibleIsOpen:j},proxies:{requestDelayForProxies:p}}=$(),O=D(()=>{j("proxyGroup",e,!l)},[l,j,e]),T=D(M=>{f&&x(ve(d,e,M))},[d,x,e,f]),m=te(!1),he=D(async()=>{if(!m.value){m.set(!0);try{await p(d,u)}catch{}m.set(!1)}},[u,d,p,m]);return s.jsxs("div",{className:B.group,children:[s.jsxs("div",{className:B.groupHead,children:[s.jsx(ae,{name:e,type:c,toggle:O,qty:u.length,isOpen:l}),s.jsx("div",{className:B.action,children:s.jsx(A,{label:"Test latency",children:s.jsx(v,{kind:"circular",onClick:he,children:s.jsx(oe,{animate:m.value,size:16})})})})]}),Nt(l?de:xe,{all:u,now:i,isSelectable:f,itemOnTapCallback:T})]})}const $t=b((e,{name:t,delay:n})=>{const r=ee(e),o=se(e),a=E(e),c=H(e),i=r[t],{all:l,type:d,now:x}=i;return{all:l,delay:n,hideUnavailableProxies:c,proxySortBy:a,proxies:r,type:d,now:x,isOpen:o[`proxyGroup:${t}`]}})(Lt),{useCallback:pe,useState:Ot}=y;function Tt({dispatch:e,apiConfig:t,name:n}){return pe(()=>e(ge(t,n)),[t,e,n])}function Bt({dispatch:e,apiConfig:t,names:n}){const[r,o]=Ot(!1);return[pe(async()=>{if(!r){o(!0);try{await e(be(t,n))}catch{}o(!1)}},[t,e,n,r]),r]}const{useState:Dt,useCallback:Ft}=y;function It({isLoading:e}){return e?s.jsx(De,{children:s.jsx(W,{width:16,height:16})}):s.jsx(W,{width:16,height:16})}function Rt({dispatch:e,apiConfig:t}){const[n,r]=Dt(!1);return[Ft(()=>{n||(r(!0),e(we(t)).then(()=>r(!1),()=>r(!1)))},[t,e,n]),n]}function Et({dispatch:e,apiConfig:t,proxyProviders:n}){const{t:r}=U(),[o,a]=Rt({dispatch:e,apiConfig:t}),[c,i]=Bt({apiConfig:t,dispatch:e,names:n.map(l=>l.name)});return s.jsx(Oe,{icon:s.jsx(It,{isLoading:a}),onClick:o,text:r("Test Latency"),style:Te,children:n.length>0?s.jsx(Be,{text:r("update_all_proxy_provider"),onClick:c,children:s.jsx(Fe,{isRotating:i})}):null})}const Ht="_updatedAt_919yi_1",Ut="_main_919yi_8",qt="_head_919yi_17",Mt="_action_919yi_23",zt="_refresh_919yi_31",C={updatedAt:Ht,main:Ut,head:qt,action:Mt,refresh:zt},{useCallback:G}=y;function Kt({name:e,proxies:t,delay:n,hideUnavailableProxies:r,proxySortBy:o,vehicleType:a,updatedAt:c,isOpen:i,dispatch:l,apiConfig:d}){const x=ce(t,n,r,o),u=te(!1),f=Tt({dispatch:l,apiConfig:d,name:e}),j=G(()=>{if(u.value)return;u.set(!0);const m=()=>u.set(!1);l(Ce(d,e)).then(m,m)},[d,l,e,u]),{app:{updateCollapsibleIsOpen:p}}=$(),O=G(()=>{p("proxyProvider",e,!i)},[i,p,e]),T=Ee(new Date(c),new Date);return s.jsxs("div",{className:C.main,children:[s.jsxs("div",{className:C.head,children:[s.jsx(ae,{name:e,toggle:O,type:a,isOpen:i,qty:x.length}),s.jsxs("div",{className:C.action,children:[s.jsx(A,{label:"Update",children:s.jsx(v,{kind:"circular",onClick:f,children:s.jsx(Zt,{})})}),s.jsx(A,{label:"Health Check",children:s.jsx(v,{kind:"circular",onClick:j,children:s.jsx(oe,{animate:u.value,size:16})})})]})]}),s.jsx("div",{className:C.updatedAt,children:s.jsxs("small",{children:["Updated ",T," ago"]})}),i?s.jsx(de,{all:x}):s.jsx(xe,{all:x})]})}const Vt={rest:{scale:1},pressed:{scale:.95}},Wt={rest:{rotate:0},hover:{rotate:360,transition:{duration:.3}}};function Zt(){const t=Pe.read().motion;return s.jsx(t.div,{className:C.refresh,variants:Vt,initial:"rest",whileHover:"hover",whileTap:"pressed",children:s.jsx(t.div,{className:"flexCenter",variants:Wt,children:s.jsx(Ie,{size:16})})})}const Gt=(e,{proxies:t,name:n})=>{const r=H(e),o=R(e),a=se(e),c=ne(e),i=E(e);return{apiConfig:c,proxies:t,delay:o,hideUnavailableProxies:r,proxySortBy:i,isOpen:a[`proxyProvider:${n}`]}},Yt=b(Gt)(Kt);function Xt({items:e}){return e.length===0?null:s.jsxs(s.Fragment,{children:[s.jsx(re,{title:"Proxy Provider"}),s.jsx("div",{children:e.map(t=>s.jsx(Yt,{name:t.name,proxies:t.proxies,type:t.type,vehicleType:t.vehicleType,updatedAt:t.updatedAt},t.name))})]})}const Qt="_labeledInput_cmki0_1",F={labeledInput:Qt},Jt=[["Natural","order_natural"],["LatencyAsc","order_latency_asc"],["LatencyDesc","order_latency_desc"],["NameAsc","order_name_asc"],["NameDesc","order_name_desc"]],{useCallback:Y}=y;function es({appConfig:e}){const{app:{updateAppConfig:t}}=$(),n=Y(a=>{t("proxySortBy",a.target.value)},[t]),r=Y(a=>{t("hideUnavailableProxies",a)},[t]),{t:o}=U();return s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:F.labeledInput,children:[s.jsx("span",{children:o("sort_in_grp")}),s.jsx("div",{children:s.jsx(He,{options:Jt.map(a=>[a[0],o(a[1])]),selected:e.proxySortBy,onChange:n})})]}),s.jsx("hr",{}),s.jsxs("div",{className:F.labeledInput,children:[s.jsx("span",{children:o("hide_unavail_proxies")}),s.jsx("div",{children:s.jsx(K,{name:"hideUnavailableProxies",checked:e.hideUnavailableProxies,onChange:r})})]}),s.jsxs("div",{className:F.labeledInput,children:[s.jsx("span",{children:o("auto_close_conns")}),s.jsx("div",{children:s.jsx(K,{name:"autoCloseOldConns",checked:e.autoCloseOldConns,onChange:a=>t("autoCloseOldConns",a)})})]})]})}const ts=e=>{const t=E(e),n=H(e),r=ke(e);return{appConfig:{proxySortBy:t,hideUnavailableProxies:n,autoCloseOldConns:r}}},ss=b(ts)(es);function ns({color:e="currentColor",size:t=24}){return s.jsxs("svg",{fill:"none",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:t,height:t,stroke:e,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[s.jsx("path",{d:"M2 6h9M18.5 6H22"}),s.jsx("circle",{cx:"16",cy:"6",r:"2"}),s.jsx("path",{d:"M22 18h-9M6 18H2"}),s.jsx("circle",{r:"2",transform:"matrix(-1 0 0 1 8 18)"})]})}const rs="_topBar_16fpp_1",os="_topBarRight_16fpp_13",as="_textFilterContainer_16fpp_22",cs="_group_16fpp_29",N={topBar:rs,topBarRight:os,textFilterContainer:as,group:cs},{useState:is,useEffect:ls,useCallback:X,useRef:us}=y;function ds({dispatch:e,groupNames:t,delay:n,proxyProviders:r,apiConfig:o,showModalClosePrevConns:a}){const c=us({}),i=X(()=>{c.current.startAt=Date.now(),e(Se(o)).then(()=>{c.current.completeAt=Date.now()})},[o,e]);ls(()=>{i();const p=()=>{c.current.startAt&&Date.now()-c.current.startAt>3e4&&i()};return window.addEventListener("focus",p,!1),()=>window.removeEventListener("focus",p,!1)},[i]);const[l,d]=is(!1),x=X(()=>{d(!1)},[]),{proxies:{closeModalClosePrevConns:u,closePrevConnsAndTheModal:f}}=$(),{t:j}=U();return s.jsxs(s.Fragment,{children:[s.jsx(V,{isOpen:l,onRequestClose:x,children:s.jsx(ss,{})}),s.jsxs("div",{className:N.topBar,children:[s.jsx(re,{title:j("Proxies")}),s.jsxs("div",{className:N.topBarRight,children:[s.jsx("div",{className:N.textFilterContainer,children:s.jsx(Re,{textAtom:Q})}),s.jsx(A,{label:j("settings"),children:s.jsx(v,{kind:"minimal",onClick:()=>d(!0),children:s.jsx(ns,{size:16})})})]})]}),s.jsx("div",{children:t.map(p=>s.jsx("div",{className:N.group,children:s.jsx($t,{name:p,delay:n,apiConfig:o,dispatch:e})},p))}),s.jsx(Xt,{items:r}),s.jsx("div",{style:{height:60}}),s.jsx(Et,{dispatch:e,apiConfig:o,proxyProviders:r}),s.jsx(V,{isOpen:a,onRequestClose:u,children:s.jsx(We,{onClickPrimaryButton:()=>f(o),onClickSecondaryButton:u})})]})}const xs=e=>({apiConfig:ne(e),groupNames:Ne(e),proxyProviders:Ae(e),delay:R(e),showModalClosePrevConns:Le(e)}),vs=b(xs)(ds);export{vs as default};
