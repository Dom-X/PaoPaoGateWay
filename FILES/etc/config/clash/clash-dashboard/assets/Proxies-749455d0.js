import{r as _,R as K,P as S,c as b,K as fe,j as s,B as v,e as m,L as je,v as _e,N as ee,O as te,b as w,Q as ve,T as ge,U as se,V as E,t as A,W as be,X as $,Y as ne,Z as M,_ as U,$ as we,a0 as Ce,u as H,a1 as ke,a2 as Pe,a3 as Se,g as re,C as oe,a4 as Ne,a as Oe,a5 as $e,a6 as Ae,a7 as Le,a8 as Te}from"./index-1c8acccb.js";import{C as De,m as V}from"./Modal.module-47c0e472.js";import{F as Fe,p as Be,A as Ie,I as Re}from"./Fab-2b20f5f3.js";import{R as Ee,a as Me,T as Ue}from"./TextFilter-903faa94.js";import{f as He}from"./index-11fa9a7f.js";import{S as qe,T as W}from"./Select-356cec5c.js";import"./debounce-c1ba2006.js";function R(){return R=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},R.apply(this,arguments)}function ze(e,t){if(e==null)return{};var n=Ke(e,t),r,o;if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)r=a[o],!(t.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}function Ke(e,t){if(e==null)return{};var n={},r=Object.keys(e),o,a;for(a=0;a<r.length;a++)o=r[a],!(t.indexOf(o)>=0)&&(n[o]=e[o]);return n}var q=_.forwardRef(function(e,t){var n=e.color,r=n===void 0?"currentColor":n,o=e.size,a=o===void 0?24:o,l=ze(e,["color","size"]);return K.createElement("svg",R({ref:t,xmlns:"http://www.w3.org/2000/svg",width:a,height:a,viewBox:"0 0 24 24",fill:"none",stroke:r,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},l),K.createElement("polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2"}))});q.propTypes={color:S.string,size:S.oneOfType([S.string,S.number])};q.displayName="Zap";const Z=q;function ae(e){const t=e.size||24,n=b({[fe.animate]:e.animate});return s.jsx("svg",{className:n,xmlns:"http://www.w3.org/2000/svg",width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:s.jsx("polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2"})})}const Ve="_FlexCenter_1380a_1",We={FlexCenter:Ve};function Ze({children:e}){return s.jsx("div",{className:We.FlexCenter,children:e})}const{useRef:G,useEffect:Ge}=m;function Ye({onClickPrimaryButton:e,onClickSecondaryButton:t}){const n=G(null),r=G(null);Ge(()=>{n.current.focus()},[]);const o=a=>{a.code==="ArrowRight"?r.current.focus():a.code==="ArrowLeft"&&n.current.focus()};return s.jsxs("div",{onKeyDown:o,children:[s.jsx("h2",{children:"Close Connections?"}),s.jsx("p",{children:"Click [Yes] to close those connections that are still using the old selected proxy in this group"}),s.jsx("div",{style:{height:30}}),s.jsxs(Ze,{children:[s.jsx(v,{onClick:e,ref:n,children:"Yes"}),s.jsx("div",{style:{width:20}}),s.jsx(v,{onClick:t,ref:r,children:"No"})]})]})}const Xe="_header_1y9js_1",Qe="_arrow_1y9js_8",Je="_isOpen_1y9js_13",et="_btn_1y9js_20",tt="_qty_1y9js_25",C={header:Xe,arrow:Qe,isOpen:Je,btn:et,qty:tt};function le({name:e,type:t,toggle:n,isOpen:r,qty:o}){const a=_.useCallback(l=>{l.preventDefault(),(l.key==="Enter"||l.key===" ")&&n()},[n]);return s.jsxs("div",{className:C.header,onClick:n,style:{cursor:"pointer"},tabIndex:0,onKeyDown:a,role:"button",children:[s.jsx("div",{children:s.jsx(je,{name:e,type:t})}),typeof o=="number"?s.jsx("span",{className:C.qty,children:o}):null,s.jsx(v,{kind:"minimal",onClick:n,className:C.btn,title:"Toggle collapsible section",children:s.jsx("span",{className:b(C.arrow,{[C.isOpen]:r}),children:s.jsx(De,{size:20})})})]})}const{useState:st,useCallback:Ns}=m;function ce(e){const[t,n]=st(e);return{value:t,set:n}}const{useMemo:nt}=m;function rt(e,t){return e.filter(n=>{const r=t[n];return r===void 0?!0:!("number"in r&&r.number===0)})}const N=(e,t)=>{if(e&&"number"in e&&e.number>0)return e.number;const n=t&&t.type;return n&&te.indexOf(n)>-1?-1:999999},ot={Natural:e=>e,LatencyAsc:(e,t,n)=>e.sort((r,o)=>{const a=N(t[r],n&&n[r]),l=N(t[o],n&&n[o]);return a-l}),LatencyDesc:(e,t,n)=>e.sort((r,o)=>{const a=N(t[r],n&&n[r]);return N(t[o],n&&n[o])-a}),NameAsc:e=>e.sort(),NameDesc:e=>e.sort((t,n)=>t>n?-1:t<n?1:0)};function at(e,t){const n=t.toLowerCase().split(" ").map(r=>r.trim()).filter(r=>!!r);return n.length===0?e:e.filter(r=>{let o=0;for(;o<n.length;o++){const a=n[o];if(r.toLowerCase().indexOf(a)>-1)return!0}return!1})}function lt(e,t,n,r,o,a){let l=[...e];return n&&(l=rt(e,t)),typeof r=="string"&&r!==""&&(l=at(l,r)),ot[o](l,t,a)}function ie(e,t,n,r,o){const[a]=_e(ee);return nt(()=>lt(e,t,n,a,r,o),[e,t,n,a,r,o])}const ct="_header_5pmv2_1",it="_groupHead_5pmv2_5",ut="_action_5pmv2_11",D={header:ct,groupHead:it,action:ut},dt="_proxy_5mgcm_1",xt="_now_5mgcm_25",pt="_error_5mgcm_29",mt="_selectable_5mgcm_32",ht="_proxyType_5mgcm_40",yt="_row_5mgcm_51",ft="_proxyName_5mgcm_57",jt="_proxySmall_5mgcm_66",h={proxy:dt,now:xt,error:pt,selectable:mt,proxyType:ht,row:yt,proxyName:ft,proxySmall:jt},_t="_proxyLatency_pw0sa_1",vt={proxyLatency:_t};function gt({latency:e,color:t}){let n=" ";if(e)switch(e.kind){case"Error":case"Testing":n="- ms";break;case"Result":n=(e.number!==0?e.number:"-")+" ms";break}return s.jsx("span",{className:vt.proxyLatency,style:{color:t},children:n})}const{useMemo:P}=m,g={good:"#67c23a",normal:"#d4b75c",bad:"#e67f3c",na:"#909399"};function ue(e){if(!e||e.kind!=="Result")return g.na;const t=e.number;return t===0?g.na:t<200?g.good:t<400?g.normal:typeof t=="number"?g.bad:g.na}function bt(e,t){return te.indexOf(t)>-1?{border:"1px dotted #777"}:{background:ue(e)}}function wt({now:e,name:t,proxy:n,latency:r,isSelectable:o,onClick:a}){const l=P(()=>bt(r,n.type),[r,n]),c=P(()=>{let u=t;return r&&r.kind==="Result"&&typeof r.number=="number"&&(u+=" "+r.number+" ms"),u},[t,r]),i=_.useCallback(()=>{o&&a&&a(t)},[t,a,o]),d=P(()=>b(h.proxySmall,{[h.now]:e,[h.selectable]:o}),[o,e]),x=_.useCallback(u=>{u.key==="Enter"&&i()},[i]);return s.jsx("div",{title:c,className:d,style:l,onClick:i,onKeyDown:x,role:o?"menuitem":""})}function Ct(e){return e==="Shadowsocks"?"SS":e}const kt=e=>({left:e.left+window.scrollX-5,top:e.top+window.scrollY-38});function Pt({children:e,label:t,"aria-label":n}){const[r,o]=ve();return s.jsxs(s.Fragment,{children:[_.cloneElement(e,r),s.jsx(ge,{...o,label:t,"aria-label":n,position:kt})]})}function St({now:e,name:t,proxy:n,latency:r,isSelectable:o,onClick:a}){const l=P(()=>ue(r),[r]),c=_.useCallback(()=>{o&&a&&a(t)},[t,a,o]),i=_.useCallback(x=>{x.key==="Enter"&&c()},[c]),d=P(()=>b(h.proxy,{[h.now]:e,[h.selectable]:o}),[o,e]);return s.jsxs("div",{tabIndex:0,className:d,onClick:c,onKeyDown:i,role:o?"menuitem":"",children:[s.jsx("div",{className:h.proxyName,children:s.jsx(Pt,{label:t,"aria-label":"proxy name: "+t,children:s.jsx("span",{children:t})})}),s.jsxs("div",{className:h.row,children:[s.jsx("span",{className:h.proxyType,style:{opacity:e?.6:.2},children:Ct(n.type)}),s.jsx(gt,{latency:r,color:l})]})]})}const de=(e,{name:t})=>{const n=se(e),r=E(e);return{proxy:n[t]||{name:t,type:"Unknown",history:[]},latency:r[t]}},Nt=w(de)(St),Ot=w(de)(wt),$t="_list_1oy7w_1",At="_listSummaryView_1oy7w_8",xe={list:$t,listSummaryView:At};function pe({all:e,now:t,isSelectable:n,itemOnTapCallback:r}){const o=e;return s.jsx("div",{className:xe.list,children:o.map(a=>s.jsx(Nt,{onClick:r,isSelectable:n,name:a,now:a===t},a))})}function me({all:e,now:t,isSelectable:n,itemOnTapCallback:r}){return s.jsx("div",{className:xe.listSummaryView,children:e.map(o=>s.jsx(Ot,{onClick:r,isSelectable:n,name:o,now:o===t},o))})}const{createElement:Lt,useCallback:F,useMemo:Tt}=m;function Dt({name:e,all:t,delay:n,hideUnavailableProxies:r,proxySortBy:o,proxies:a,type:l,now:c,isOpen:i,apiConfig:d,dispatch:x}){const u=ie(t,n,r,o,a),f=Tt(()=>l==="Selector",[l]),{app:{updateCollapsibleIsOpen:j},proxies:{requestDelayForProxies:p}}=A(),L=F(()=>{j("proxyGroup",e,!i)},[i,j,e]),T=F(z=>{f&&x(be(d,e,z))},[d,x,e,f]),y=ce(!1),ye=F(async()=>{if(!y.value){y.set(!0);try{await p(d,u)}catch{}y.set(!1)}},[u,d,p,y]);return s.jsxs("div",{className:D.group,children:[s.jsxs("div",{className:D.groupHead,children:[s.jsx(le,{name:e,type:l,toggle:L,qty:u.length,isOpen:i}),s.jsx("div",{className:D.action,children:s.jsx($,{label:"Test latency",children:s.jsx(v,{kind:"circular",onClick:ye,children:s.jsx(ae,{animate:y.value,size:16})})})})]}),Lt(i?pe:me,{all:u,now:c,isSelectable:f,itemOnTapCallback:T})]})}const Ft=w((e,{name:t,delay:n})=>{const r=se(e),o=ne(e),a=M(e),l=U(e),c=r[t],{all:i,type:d,now:x}=c;return{all:i,delay:n,hideUnavailableProxies:l,proxySortBy:a,proxies:r,type:d,now:x,isOpen:o[`proxyGroup:${t}`]}})(Dt),{useCallback:he,useState:Bt}=m;function It({dispatch:e,apiConfig:t,name:n}){return he(()=>e(we(t,n)),[t,e,n])}function Rt({dispatch:e,apiConfig:t,names:n}){const[r,o]=Bt(!1);return[he(async()=>{if(!r){o(!0);try{await e(Ce(t,n))}catch{}o(!1)}},[t,e,n,r]),r]}const{useState:Et,useCallback:Mt}=m;function Ut({isLoading:e}){return e?s.jsx(Re,{children:s.jsx(Z,{width:16,height:16})}):s.jsx(Z,{width:16,height:16})}function Ht({dispatch:e,apiConfig:t}){const[n,r]=Et(!1);return[Mt(()=>{n||(r(!0),e(ke(t)).then(()=>r(!1),()=>r(!1)))},[t,e,n]),n]}function qt({dispatch:e,apiConfig:t,proxyProviders:n}){const{t:r}=H(),[o,a]=Ht({dispatch:e,apiConfig:t}),[l,c]=Rt({apiConfig:t,dispatch:e,names:n.map(i=>i.name)});return s.jsx(Fe,{icon:s.jsx(Ut,{isLoading:a}),onClick:o,text:r("Test Latency"),style:Be,children:n.length>0?s.jsx(Ie,{text:r("update_all_proxy_provider"),onClick:l,children:s.jsx(Ee,{isRotating:c})}):null})}const zt="_updatedAt_919yi_1",Kt="_main_919yi_8",Vt="_head_919yi_17",Wt="_action_919yi_23",Zt="_refresh_919yi_31",k={updatedAt:zt,main:Kt,head:Vt,action:Wt,refresh:Zt},{useCallback:Y}=m;function Gt({name:e,proxies:t,delay:n,hideUnavailableProxies:r,proxySortBy:o,vehicleType:a,updatedAt:l,isOpen:c,dispatch:i,apiConfig:d}){const x=ie(t,n,r,o),u=ce(!1),f=It({dispatch:i,apiConfig:d,name:e}),j=Y(()=>{if(u.value)return;u.set(!0);const y=()=>u.set(!1);i(Pe(d,e)).then(y,y)},[d,i,e,u]),{app:{updateCollapsibleIsOpen:p}}=A(),L=Y(()=>{p("proxyProvider",e,!c)},[c,p,e]),T=He(new Date(l),new Date);return s.jsxs("div",{className:k.main,children:[s.jsxs("div",{className:k.head,children:[s.jsx(le,{name:e,toggle:L,type:a,isOpen:c,qty:x.length}),s.jsxs("div",{className:k.action,children:[s.jsx($,{label:"Update",children:s.jsx(v,{kind:"circular",onClick:f,children:s.jsx(Qt,{})})}),s.jsx($,{label:"Health Check",children:s.jsx(v,{kind:"circular",onClick:j,children:s.jsx(ae,{animate:u.value,size:16})})})]})]}),s.jsx("div",{className:k.updatedAt,children:s.jsxs("small",{children:["Updated ",T," ago"]})}),c?s.jsx(pe,{all:x}):s.jsx(me,{all:x})]})}const Yt={rest:{scale:1},pressed:{scale:.95}},Xt={rest:{rotate:0},hover:{rotate:360,transition:{duration:.3}}};function Qt(){const t=Se.read().motion;return s.jsx(t.div,{className:k.refresh,variants:Yt,initial:"rest",whileHover:"hover",whileTap:"pressed",children:s.jsx(t.div,{className:"flexCenter",variants:Xt,children:s.jsx(Me,{size:16})})})}const Jt=(e,{proxies:t,name:n})=>{const r=U(e),o=E(e),a=ne(e),l=re(e),c=M(e);return{apiConfig:l,proxies:t,delay:o,hideUnavailableProxies:r,proxySortBy:c,isOpen:a[`proxyProvider:${n}`]}},es=w(Jt)(Gt);function ts({items:e}){return e.length===0?null:s.jsxs(s.Fragment,{children:[s.jsx(oe,{title:"Proxy Provider"}),s.jsx("div",{children:e.map(t=>s.jsx(es,{name:t.name,proxies:t.proxies,type:t.type,vehicleType:t.vehicleType,updatedAt:t.updatedAt},t.name))})]})}const ss="_labeledInput_cmki0_1",B={labeledInput:ss},ns=[["Natural","order_natural"],["LatencyAsc","order_latency_asc"],["LatencyDesc","order_latency_desc"],["NameAsc","order_name_asc"],["NameDesc","order_name_desc"]],{useCallback:X}=m;function rs({appConfig:e}){const{app:{updateAppConfig:t}}=A(),n=X(a=>{t("proxySortBy",a.target.value)},[t]),r=X(a=>{t("hideUnavailableProxies",a)},[t]),{t:o}=H();return s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:B.labeledInput,children:[s.jsx("span",{children:o("sort_in_grp")}),s.jsx("div",{children:s.jsx(qe,{options:ns.map(a=>[a[0],o(a[1])]),selected:e.proxySortBy,onChange:n})})]}),s.jsx("hr",{}),s.jsxs("div",{className:B.labeledInput,children:[s.jsx("label",{htmlFor:"hideUnavailableProxies",children:o("hide_unavail_proxies")}),s.jsx("div",{children:s.jsx(W,{id:"hideUnavailableProxies",checked:e.hideUnavailableProxies,onChange:r})})]}),s.jsxs("div",{className:B.labeledInput,children:[s.jsx("label",{htmlFor:"autoCloseOldConns",children:o("auto_close_conns")}),s.jsx("div",{children:s.jsx(W,{id:"autoCloseOldConns",checked:e.autoCloseOldConns,onChange:a=>t("autoCloseOldConns",a)})})]})]})}const os=e=>{const t=M(e),n=U(e),r=Ne(e);return{appConfig:{proxySortBy:t,hideUnavailableProxies:n,autoCloseOldConns:r}}},as=w(os)(rs),ls="_overlay_uuk3b_1",cs="_cnt_uuk3b_5",is="_afterOpen_uuk3b_16",I={overlay:ls,cnt:cs,afterOpen:is},{useMemo:us}=m;function Q({isOpen:e,onRequestClose:t,children:n}){const r=us(()=>({base:b(V.content,I.cnt),afterOpen:I.afterOpen,beforeClose:""}),[]);return s.jsx(Oe,{isOpen:e,onRequestClose:t,className:r,overlayClassName:b(V.overlay,I.overlay),children:n})}function ds({color:e="currentColor",size:t=24}){return s.jsxs("svg",{fill:"none",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:t,height:t,stroke:e,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[s.jsx("path",{d:"M2 6h9M18.5 6H22"}),s.jsx("circle",{cx:"16",cy:"6",r:"2"}),s.jsx("path",{d:"M22 18h-9M6 18H2"}),s.jsx("circle",{r:"2",transform:"matrix(-1 0 0 1 8 18)"})]})}const xs="_topBar_16fpp_1",ps="_topBarRight_16fpp_13",ms="_textFilterContainer_16fpp_22",hs="_group_16fpp_29",O={topBar:xs,topBarRight:ps,textFilterContainer:ms,group:hs},{useState:ys,useEffect:fs,useCallback:J,useRef:js}=m;function _s({dispatch:e,groupNames:t,delay:n,proxyProviders:r,apiConfig:o,showModalClosePrevConns:a}){const l=js({}),c=J(()=>{l.current.startAt=Date.now(),e($e(o)).then(()=>{l.current.completeAt=Date.now()})},[o,e]);fs(()=>{c();const p=()=>{l.current.startAt&&Date.now()-l.current.startAt>3e4&&c()};return window.addEventListener("focus",p,!1),()=>window.removeEventListener("focus",p,!1)},[c]);const[i,d]=ys(!1),x=J(()=>{d(!1)},[]),{proxies:{closeModalClosePrevConns:u,closePrevConnsAndTheModal:f}}=A(),{t:j}=H();return s.jsxs(s.Fragment,{children:[s.jsx(Q,{isOpen:i,onRequestClose:x,children:s.jsx(as,{})}),s.jsxs("div",{className:O.topBar,children:[s.jsx(oe,{title:j("Proxies")}),s.jsxs("div",{className:O.topBarRight,children:[s.jsx("div",{className:O.textFilterContainer,children:s.jsx(Ue,{textAtom:ee})}),s.jsx($,{label:j("settings"),children:s.jsx(v,{kind:"minimal",onClick:()=>d(!0),children:s.jsx(ds,{size:16})})})]})]}),s.jsx("div",{children:t.map(p=>s.jsx("div",{className:O.group,children:s.jsx(Ft,{name:p,delay:n,apiConfig:o,dispatch:e})},p))}),s.jsx(ts,{items:r}),s.jsx("div",{style:{height:60}}),s.jsx(qt,{dispatch:e,apiConfig:o,proxyProviders:r}),s.jsx(Q,{isOpen:a,onRequestClose:u,children:s.jsx(Ye,{onClickPrimaryButton:()=>f(o),onClickSecondaryButton:u})})]})}const vs=e=>({apiConfig:re(e),groupNames:Ae(e),proxyProviders:Le(e),delay:E(e),showModalClosePrevConns:Te(e)}),Os=w(vs)(_s);export{Os as default};
