import{r as _,R as G,P as A,c as w,K as ve,j as s,B as v,e as h,L as ge,v as we,N as ne,O as re,b,Q as be,T as Ce,U as oe,V as q,t as D,W as ke,u as S,X as B,Y as ae,Z as z,_ as K,$ as Pe,a0 as Se,a1 as Ne,a2 as $e,a3 as Ae,g as le,a4 as ce,C as ie,a5 as Te,a as Le,a6 as Oe,a7 as Be,a8 as De}from"./index-969cf72a.js";import{C as Fe,m as V}from"./Modal.module-ed8aaa1f.js";import{F as Me,p as Re,A as Ee,I as Ue}from"./Fab-e423cc40.js";import{R as Ie,a as He,T as qe}from"./TextFilter-78284216.js";import{S as ze,T as W}from"./Select-dedf689a.js";import"./debounce-c1ba2006.js";function H(){return H=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},H.apply(this,arguments)}function Ke(e,t){if(e==null)return{};var n=Ye(e,t),r,o;if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)r=a[o],!(t.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}function Ye(e,t){if(e==null)return{};var n={},r=Object.keys(e),o,a;for(a=0;a<r.length;a++)o=r[a],!(t.indexOf(o)>=0)&&(n[o]=e[o]);return n}var Y=_.forwardRef(function(e,t){var n=e.color,r=n===void 0?"currentColor":n,o=e.size,a=o===void 0?24:o,l=Ke(e,["color","size"]);return G.createElement("svg",H({ref:t,xmlns:"http://www.w3.org/2000/svg",width:a,height:a,viewBox:"0 0 24 24",fill:"none",stroke:r,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},l),G.createElement("polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2"}))});Y.propTypes={color:A.string,size:A.oneOfType([A.string,A.number])};Y.displayName="Zap";const X=Y;function ue(e){const t=e.size||24,n=w({[ve.animate]:e.animate});return s.jsx("svg",{className:n,xmlns:"http://www.w3.org/2000/svg",width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:s.jsx("polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2"})})}const Ze="_FlexCenter_1380a_1",Ge={FlexCenter:Ze};function Ve({children:e}){return s.jsx("div",{className:Ge.FlexCenter,children:e})}const{useRef:Q,useEffect:We}=h;function Xe({onClickPrimaryButton:e,onClickSecondaryButton:t}){const n=Q(null),r=Q(null);We(()=>{n.current.focus()},[]);const o=a=>{a.code==="ArrowRight"?r.current.focus():a.code==="ArrowLeft"&&n.current.focus()};return s.jsxs("div",{onKeyDown:o,children:[s.jsx("h2",{children:"Close Connections?"}),s.jsx("p",{children:"Click [Yes] to close those connections that are still using the old selected proxy in this group"}),s.jsx("div",{style:{height:30}}),s.jsxs(Ve,{children:[s.jsx(v,{onClick:e,ref:n,children:"Yes"}),s.jsx("div",{style:{width:20}}),s.jsx(v,{onClick:t,ref:r,children:"No"})]})]})}const Qe="_header_1y9js_1",Je="_arrow_1y9js_8",et="_isOpen_1y9js_13",tt="_btn_1y9js_20",st="_qty_1y9js_25",C={header:Qe,arrow:Je,isOpen:et,btn:tt,qty:st};function de({name:e,type:t,toggle:n,isOpen:r,qty:o}){const a=_.useCallback(l=>{l.preventDefault(),(l.key==="Enter"||l.key===" ")&&n()},[n]);return s.jsxs("div",{className:C.header,onClick:n,style:{cursor:"pointer"},tabIndex:0,onKeyDown:a,role:"button",children:[s.jsx("div",{children:s.jsx(ge,{name:e,type:t})}),typeof o=="number"?s.jsx("span",{className:C.qty,children:o}):null,s.jsx(v,{kind:"minimal",onClick:n,className:C.btn,title:"Toggle collapsible section",children:s.jsx("span",{className:w(C.arrow,{[C.isOpen]:r}),children:s.jsx(Fe,{size:20})})})]})}const{useState:nt,useCallback:$s}=h;function xe(e){const[t,n]=nt(e);return{value:t,set:n}}const{useMemo:rt}=h;function ot(e,t){return e.filter(n=>{const r=t[n];return r===void 0?!0:!("number"in r&&r.number===0)})}const T=(e,t)=>{if(e&&"number"in e&&e.number>0)return e.number;const n=t&&t.type;return n&&re.indexOf(n)>-1?-1:999999},at={Natural:e=>e,LatencyAsc:(e,t,n)=>e.sort((r,o)=>{const a=T(t[r],n&&n[r]),l=T(t[o],n&&n[o]);return a-l}),LatencyDesc:(e,t,n)=>e.sort((r,o)=>{const a=T(t[r],n&&n[r]);return T(t[o],n&&n[o])-a}),NameAsc:e=>e.sort(),NameDesc:e=>e.sort((t,n)=>t>n?-1:t<n?1:0)};function lt(e,t){const n=t.toLowerCase().split(" ").map(r=>r.trim()).filter(r=>!!r);return n.length===0?e:e.filter(r=>{let o=0;for(;o<n.length;o++){const a=n[o];if(r.toLowerCase().indexOf(a)>-1)return!0}return!1})}function ct(e,t,n,r,o,a){let l=[...e];return n&&(l=ot(e,t)),typeof r=="string"&&r!==""&&(l=lt(l,r)),at[o](l,t,a)}function pe(e,t,n,r,o){const[a]=we(ne);return rt(()=>ct(e,t,n,a,r,o),[e,t,n,a,r,o])}const it="_header_5pmv2_1",ut="_groupHead_5pmv2_5",dt="_action_5pmv2_11",R={header:it,groupHead:ut,action:dt},xt="_proxy_5mgcm_1",pt="_now_5mgcm_25",ht="_error_5mgcm_29",mt="_selectable_5mgcm_32",ft="_proxyType_5mgcm_40",yt="_row_5mgcm_51",jt="_proxyName_5mgcm_57",_t="_proxySmall_5mgcm_66",y={proxy:xt,now:pt,error:ht,selectable:mt,proxyType:ft,row:yt,proxyName:jt,proxySmall:_t},vt="_proxyLatency_pw0sa_1",gt={proxyLatency:vt};function wt({latency:e,color:t}){let n=" ";if(e)switch(e.kind){case"Error":case"Testing":n="- ms";break;case"Result":n=(e.number!==0?e.number:"-")+" ms";break}return s.jsx("span",{className:gt.proxyLatency,style:{color:t},children:n})}const{useMemo:P}=h,g={good:"#67c23a",normal:"#d4b75c",bad:"#e67f3c",na:"#909399"};function he(e){if(!e||e.kind!=="Result")return g.na;const t=e.number;return t===0?g.na:t<200?g.good:t<400?g.normal:typeof t=="number"?g.bad:g.na}function bt(e,t){return re.indexOf(t)>-1?{border:"1px dotted #777"}:{background:he(e)}}function Ct({now:e,name:t,proxy:n,latency:r,isSelectable:o,onClick:a}){const l=P(()=>bt(r,n.type),[r,n]),u=P(()=>{let d=t;return r&&r.kind==="Result"&&typeof r.number=="number"&&(d+=" "+r.number+" ms"),d},[t,r]),c=_.useCallback(()=>{o&&a&&a(t)},[t,a,o]),x=P(()=>w(y.proxySmall,{[y.now]:e,[y.selectable]:o}),[o,e]),i=_.useCallback(d=>{d.key==="Enter"&&c()},[c]);return s.jsx("div",{title:u,className:x,style:l,onClick:c,onKeyDown:i,role:o?"menuitem":""})}function kt(e){return e==="Shadowsocks"?"SS":e}const Pt=e=>({left:e.left+window.scrollX-5,top:e.top+window.scrollY-38});function St({children:e,label:t,"aria-label":n}){const[r,o]=be();return s.jsxs(s.Fragment,{children:[_.cloneElement(e,r),s.jsx(Ce,{...o,label:t,"aria-label":n,position:Pt})]})}function Nt({now:e,name:t,proxy:n,latency:r,isSelectable:o,onClick:a}){const l=P(()=>he(r),[r]),u=_.useCallback(()=>{o&&a&&a(t)},[t,a,o]),c=_.useCallback(i=>{i.key==="Enter"&&u()},[u]),x=P(()=>w(y.proxy,{[y.now]:e,[y.selectable]:o}),[o,e]);return s.jsxs("div",{tabIndex:0,className:x,onClick:u,onKeyDown:c,role:o?"menuitem":"",children:[s.jsx("div",{className:y.proxyName,children:s.jsx(St,{label:t,"aria-label":"proxy name: "+t,children:s.jsx("span",{children:t})})}),s.jsxs("div",{className:y.row,children:[s.jsx("span",{className:y.proxyType,style:{opacity:e?.6:.2},children:kt(n.type)}),s.jsx(wt,{latency:r,color:l})]})]})}const me=(e,{name:t})=>{const n=oe(e),r=q(e);return{proxy:n[t]||{name:t,type:"Unknown",history:[]},latency:r[t]}},$t=b(me)(Nt),At=b(me)(Ct),Tt="_list_1oy7w_1",Lt="_listSummaryView_1oy7w_8",fe={list:Tt,listSummaryView:Lt};function ye({all:e,now:t,isSelectable:n,itemOnTapCallback:r}){const o=e;return s.jsx("div",{className:fe.list,children:o.map(a=>s.jsx($t,{onClick:r,isSelectable:n,name:a,now:a===t},a))})}function je({all:e,now:t,isSelectable:n,itemOnTapCallback:r}){return s.jsx("div",{className:fe.listSummaryView,children:e.map(o=>s.jsx(At,{onClick:r,isSelectable:n,name:o,now:o===t},o))})}const{createElement:Ot,useCallback:E,useMemo:Bt}=h;function Dt({name:e,all:t,delay:n,hideUnavailableProxies:r,proxySortBy:o,proxies:a,type:l,now:u,isOpen:c,apiConfig:x,dispatch:i}){const d=pe(t,n,r,o,a),f=Bt(()=>l==="Selector",[l]),{app:{updateCollapsibleIsOpen:p},proxies:{requestDelayForProxies:m}}=D(),F=E(()=>{p("proxyGroup",e,!c)},[c,p,e]),N=E(Z=>{f&&i(ke(x,e,Z))},[x,i,e,f]),{t:M}=S(),j=xe(!1),$=E(async()=>{if(!j.value){j.set(!0);try{await m(x,d)}catch{}j.set(!1)}},[d,x,m,j]);return s.jsxs("div",{className:R.group,children:[s.jsxs("div",{className:R.groupHead,children:[s.jsx(de,{name:e,type:l,toggle:F,qty:d.length,isOpen:c}),s.jsx("div",{className:R.action,children:s.jsx(B,{label:M("Test Latency"),children:s.jsx(v,{kind:"circular",onClick:$,children:s.jsx(ue,{animate:j.value,size:16})})})})]}),Ot(c?ye:je,{all:d,now:u,isSelectable:f,itemOnTapCallback:N})]})}const Ft=b((e,{name:t,delay:n})=>{const r=oe(e),o=ae(e),a=z(e),l=K(e),u=r[t],{all:c,type:x,now:i}=u;return{all:c,delay:n,hideUnavailableProxies:l,proxySortBy:a,proxies:r,type:x,now:i,isOpen:o[`proxyGroup:${t}`]}})(Dt),{useCallback:_e,useState:Mt}=h;function Rt({dispatch:e,apiConfig:t,name:n}){return _e(()=>e(Pe(t,n)),[t,e,n])}function Et({dispatch:e,apiConfig:t,names:n}){const[r,o]=Mt(!1);return[_e(async()=>{if(!r){o(!0);try{await e(Se(t,n))}catch{}o(!1)}},[t,e,n,r]),r]}const{useState:Ut,useCallback:It}=h;function Ht({isLoading:e}){return e?s.jsx(Ue,{children:s.jsx(X,{width:16,height:16})}):s.jsx(X,{width:16,height:16})}function qt({dispatch:e,apiConfig:t}){const[n,r]=Ut(!1);return[It(()=>{n||(r(!0),e(Ne(t)).then(()=>r(!1),()=>r(!1)))},[t,e,n]),n]}function zt({dispatch:e,apiConfig:t,proxyProviders:n}){const{t:r}=S(),[o,a]=qt({dispatch:e,apiConfig:t}),[l,u]=Et({apiConfig:t,dispatch:e,names:n.map(c=>c.name)});return s.jsx(Me,{icon:s.jsx(Ht,{isLoading:a}),onClick:o,text:r("Test Latency"),style:Re,children:n.length>0?s.jsx(Ee,{text:r("update_all_proxy_provider"),onClick:l,children:s.jsx(Ie,{isRotating:u})}):null})}const Kt="_updatedAt_919yi_1",Yt="_main_919yi_8",Zt="_head_919yi_17",Gt="_action_919yi_23",Vt="_refresh_919yi_31",k={updatedAt:Kt,main:Yt,head:Zt,action:Gt,refresh:Vt},{useCallback:J}=h;function L(e,t=2){if(e===0)return"0 B";const n=1024,r=t<0?0:t,o=["B","KB","MB","GB","TB","PB","EB","ZB","YB"],a=Math.floor(Math.log(e)/Math.log(n));return parseFloat((e/Math.pow(n,a)).toFixed(r))+" "+o[a]}function Wt(e,t){const n=new Date().getTime(),r=new Date(e).getTime(),o=Math.floor((n-r)/1e3);if(o<60)return t("justNow");const a=Math.floor(o/60);if(a<60)return`${a} ${t("minutesAgo")}`;const l=Math.floor(a/60);if(l<24)return`${l} ${t("hoursAgo")}`;const u=Math.floor(l/24);if(u<30)return`${u} ${t("daysAgo")}`;const c=Math.floor(u/30);return c<12?`${c} ${t("monthsAgo")}`:`${Math.floor(c/12)} ${t("yearsAgo")}`}function Xt({name:e,proxies:t,delay:n,hideUnavailableProxies:r,proxySortBy:o,vehicleType:a,updatedAt:l,isOpen:u,dispatch:c,apiConfig:x,subscriptionInfo:i}){const{t:d}=S(),f=pe(t,n,r,o),p=xe(!1),m=Rt({dispatch:c,apiConfig:x,name:e}),F=J(()=>{if(p.value)return;p.set(!0);const $=()=>p.set(!1);c($e(x,e)).then($,$)},[x,c,e,p]),{app:{updateCollapsibleIsOpen:N}}=D(),M=J(()=>{N("proxyProvider",e,!u)},[u,N,e]),j=Wt(new Date(l),d);return s.jsxs("div",{className:k.main,children:[s.jsxs("div",{className:k.head,children:[s.jsx(de,{name:e,toggle:M,type:a,isOpen:u,qty:f.length}),s.jsxs("div",{className:k.action,children:[s.jsx(B,{label:d("Update"),children:s.jsx(v,{kind:"circular",onClick:m,children:s.jsx(es,{})})}),s.jsx(B,{label:d("Test Latency"),children:s.jsx(v,{kind:"circular",onClick:F,children:s.jsx(ue,{animate:p.value,size:16})})})]})]}),s.jsx("div",{className:k.updatedAt,children:s.jsxs("small",{children:[d("Updated")," ",j,i&&s.jsxs(s.Fragment,{children:[i.Download!==void 0&&s.jsxs("span",{children:[" | ",d("Download")," ",L(i.Download)]}),i.Upload!==void 0&&s.jsxs("span",{children:[", ",d("Upload")," ",L(i.Upload)]}),i.Total!==void 0&&s.jsxs("span",{children:[", ",d("Remaining")," ",L(Math.max(0,i.Total-((i.Download!==void 0?i.Download:0)+(i.Upload!==void 0?i.Upload:0))))," / ",L(i.Total)]}),i.Expire&&s.jsxs("span",{children:[", ",d("Expires"),": ",new Date(i.Expire*1e3).toLocaleDateString()]})]})]})}),u?s.jsx(ye,{all:f}):s.jsx(je,{all:f})]})}const Qt={rest:{scale:1},pressed:{scale:.95}},Jt={rest:{rotate:0},hover:{rotate:360,transition:{duration:.3}}};function es(){const t=Ae.read().motion;return s.jsx(t.div,{className:k.refresh,variants:Qt,initial:"rest",whileHover:"hover",whileTap:"pressed",children:s.jsx(t.div,{className:"flexCenter",variants:Jt,children:s.jsx(He,{size:16})})})}const ts=(e,t)=>{const n=K(e),r=q(e),o=ae(e),a=le(e),l=z(e),c=ce(e).find(i=>i.name===t.name),x=c==null?void 0:c.subscriptionInfo;return{apiConfig:a,proxies:(c==null?void 0:c.proxies)||[],delay:r,hideUnavailableProxies:n,proxySortBy:l,isOpen:o[`proxyProvider:${t.name}`],subscriptionInfo:x,updatedAt:c==null?void 0:c.updatedAt,vehicleType:c==null?void 0:c.vehicleType}},ss=b(ts)(Xt);function ns({items:e}){return e.length===0?null:s.jsxs(s.Fragment,{children:[s.jsx(ie,{title:"Proxy Provider"}),s.jsx("div",{children:e.map(t=>s.jsx(ss,{name:t.name,proxies:t.proxies,type:t.type,vehicleType:t.vehicleType,updatedAt:t.updatedAt},t.name))})]})}const rs="_labeledInput_cmki0_1",U={labeledInput:rs},os=[["Natural","order_natural"],["LatencyAsc","order_latency_asc"],["LatencyDesc","order_latency_desc"],["NameAsc","order_name_asc"],["NameDesc","order_name_desc"]],{useCallback:ee}=h;function as({appConfig:e}){const{app:{updateAppConfig:t}}=D(),n=ee(a=>{t("proxySortBy",a.target.value)},[t]),r=ee(a=>{t("hideUnavailableProxies",a)},[t]),{t:o}=S();return s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:U.labeledInput,children:[s.jsx("span",{children:o("sort_in_grp")}),s.jsx("div",{children:s.jsx(ze,{options:os.map(a=>[a[0],o(a[1])]),selected:e.proxySortBy,onChange:n})})]}),s.jsx("hr",{}),s.jsxs("div",{className:U.labeledInput,children:[s.jsx("label",{htmlFor:"hideUnavailableProxies",children:o("hide_unavail_proxies")}),s.jsx("div",{children:s.jsx(W,{id:"hideUnavailableProxies",checked:e.hideUnavailableProxies,onChange:r})})]}),s.jsxs("div",{className:U.labeledInput,children:[s.jsx("label",{htmlFor:"autoCloseOldConns",children:o("auto_close_conns")}),s.jsx("div",{children:s.jsx(W,{id:"autoCloseOldConns",checked:e.autoCloseOldConns,onChange:a=>t("autoCloseOldConns",a)})})]})]})}const ls=e=>{const t=z(e),n=K(e),r=Te(e);return{appConfig:{proxySortBy:t,hideUnavailableProxies:n,autoCloseOldConns:r}}},cs=b(ls)(as),is="_overlay_uuk3b_1",us="_cnt_uuk3b_5",ds="_afterOpen_uuk3b_16",I={overlay:is,cnt:us,afterOpen:ds},{useMemo:xs}=h;function te({isOpen:e,onRequestClose:t,children:n}){const r=xs(()=>({base:w(V.content,I.cnt),afterOpen:I.afterOpen,beforeClose:""}),[]);return s.jsx(Le,{isOpen:e,onRequestClose:t,className:r,overlayClassName:w(V.overlay,I.overlay),children:n})}function ps({color:e="currentColor",size:t=24}){return s.jsxs("svg",{fill:"none",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:t,height:t,stroke:e,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[s.jsx("path",{d:"M2 6h9M18.5 6H22"}),s.jsx("circle",{cx:"16",cy:"6",r:"2"}),s.jsx("path",{d:"M22 18h-9M6 18H2"}),s.jsx("circle",{r:"2",transform:"matrix(-1 0 0 1 8 18)"})]})}const hs="_topBar_16fpp_1",ms="_topBarRight_16fpp_13",fs="_textFilterContainer_16fpp_22",ys="_group_16fpp_29",O={topBar:hs,topBarRight:ms,textFilterContainer:fs,group:ys},{useState:js,useEffect:_s,useCallback:se,useRef:vs}=h;function gs({dispatch:e,groupNames:t,delay:n,proxyProviders:r,apiConfig:o,showModalClosePrevConns:a}){const l=vs({}),u=se(()=>{l.current.startAt=Date.now(),e(Oe(o)).then(()=>{l.current.completeAt=Date.now()})},[o,e]);_s(()=>{u();const m=()=>{l.current.startAt&&Date.now()-l.current.startAt>3e4&&u()};return window.addEventListener("focus",m,!1),()=>window.removeEventListener("focus",m,!1)},[u]);const[c,x]=js(!1),i=se(()=>{x(!1)},[]),{proxies:{closeModalClosePrevConns:d,closePrevConnsAndTheModal:f}}=D(),{t:p}=S();return s.jsxs(s.Fragment,{children:[s.jsx(te,{isOpen:c,onRequestClose:i,children:s.jsx(cs,{})}),s.jsxs("div",{className:O.topBar,children:[s.jsx(ie,{title:p("Proxies")}),s.jsxs("div",{className:O.topBarRight,children:[s.jsx("div",{className:O.textFilterContainer,children:s.jsx(qe,{textAtom:ne})}),s.jsx(B,{label:p("settings"),children:s.jsx(v,{kind:"minimal",onClick:()=>x(!0),children:s.jsx(ps,{size:16})})})]})]}),s.jsx("div",{children:t.map(m=>s.jsx("div",{className:O.group,children:s.jsx(Ft,{name:m,delay:n,apiConfig:o,dispatch:e})},m))}),s.jsx(ns,{items:r}),s.jsx("div",{style:{height:60}}),s.jsx(zt,{dispatch:e,apiConfig:o,proxyProviders:r}),s.jsx(te,{isOpen:a,onRequestClose:d,children:s.jsx(Xe,{onClickPrimaryButton:()=>f(o),onClickSecondaryButton:d})})]})}const ws=e=>({apiConfig:le(e),groupNames:Be(e),proxyProviders:ce(e),delay:q(e),showModalClosePrevConns:De(e)}),As=b(ws)(gs);export{As as default};
