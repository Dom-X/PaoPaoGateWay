import{r as j,j as e,s as _,e as P,h as k,c as U,i as V,k as I,l as R,n as z,b as E,o as G,g as L,q,t as F,v,w as H,x as J,u as W,C as K,y as Q,z as X,A as Y,D as Z}from"./index-17fa2fa5.js";import{r as ee}from"./logs-367bea05.js";import{S as b}from"./Select-54a41ffb.js";function te({id:t,label:a,checked:n,disabled:l,onChange:c}){const[o,i]=j.useState(!!n),u=j.useRef(!!n);j.useEffect(()=>{u.current!==n&&i(!!n),u.current=!!n},[n]);const h=j.useCallback(f=>{l||(i(f.target.checked),c&&c(f))},[l,c]);return e.jsxs("label",{htmlFor:t,className:_.toggle,children:[e.jsx("input",{className:_.input,id:t,type:"checkbox",onChange:h,checked:o,disabled:l}),e.jsx("span",{className:_.track}),a]})}const{useState:se,useRef:ne,useEffect:ae,useCallback:ce}=k;function le({value:t,...a}){const[n,l]=se(t),c=ne(t);ae(()=>{c.current!==t&&l(t),c.current=t},[t]);const o=ce(i=>l(i.target.value),[l]);return e.jsx("input",{className:P.input,value:n,onChange:o,...a})}const oe="_root_9c0c8_1",re="_section_9c0c8_2",ie="_item_9c0c8_14",de="_wrapSwitch_9c0c8_30",ue="_sep_9c0c8_36",pe="_label_9c0c8_49",d={root:oe,section:re,item:ie,wrapSwitch:de,sep:ue,label:pe},ge="_fieldset_1ghjp_1",he="_input_1ghjp_9",me="_cnt_1ghjp_9",S={fieldset:ge,input:he,cnt:me};function fe({OptionComponent:t,optionPropsList:a,selectedIndex:n,onChange:l}){const c=U("visually-hidden",S.input),o=i=>{l(i.target.value)};return e.jsx("fieldset",{className:S.fieldset,children:a.map((i,u)=>e.jsxs("label",{children:[e.jsx("input",{type:"radio",checked:n===u,name:"selection",value:u,"aria-labelledby":"traffic chart type "+u,onChange:o,className:c}),e.jsx("div",{className:S.cnt,children:e.jsx(t,{...i})})]},u))})}const{useMemo:xe}=k,je={plugins:{legend:{display:!1}},scales:{x:{display:!1,type:"category"},y:{display:!1,type:"linear"}}},$=[23e3,35e3,46e3,33e3,9e4,68e3,23e3,45e3],Ce=[184e3,183e3,196e3,182e3,19e4,186e3,182e3,189e3],_e=$;function ve({id:t}){const a=V.read(),n=xe(()=>({labels:_e,datasets:[{...I,...R[t].up,data:$},{...I,...R[t].down,data:Ce}]}),[t]),l="chart-"+t;return z(a.Chart,l,n,null,je),e.jsx("div",{style:{width:100,padding:5},children:e.jsx("canvas",{id:l})})}const{useEffect:T,useState:be,useCallback:m,useRef:Se,useMemo:ke}=k,ye=[{id:0},{id:1},{id:2},{id:3}],we=[["debug","Debug"],["info","Info"],["warning","Warning"],["error","Error"],["silent","Silent"]],Ne=[["zh","中文"],["en","English"]],Ie=[["Global","Global"],["Rule","Rule"],["Direct","Direct"]],Re=t=>({configs:G(t),apiConfig:L(t)}),Ee=t=>({selectedChartStyleIndex:Y(t),latencyTestUrl:Z(t),apiConfig:L(t)}),Le=E(Ee)(Te),De=E(Re)($e);function $e({dispatch:t,configs:a,apiConfig:n}){return T(()=>{t(q(n))},[t,n]),e.jsx(Le,{configs:a})}function Te({dispatch:t,configs:a,selectedChartStyleIndex:n,latencyTestUrl:l,apiConfig:c}){const[o,i]=be(a),u=Se(a);T(()=>{u.current!==a&&i(a),u.current=a},[a]),m(()=>{t(F("apiConfig"))},[t]);const h=m((s,r)=>{i({...o,[s]:r})},[o]),f=m(s=>{const r="allow-lan",p=s;h(r,p),t(v(c,{"allow-lan":p}))},[c,t,h]),x=m(({name:s,value:r})=>{switch(s){case"mode":case"log-level":h(s,r),t(v(c,{[s]:r})),s==="log-level"&&ee({...c,logLevel:r});break;case"redir-port":case"socks-port":case"mixed-port":case"port":if(r!==""){const p=parseInt(r,10);if(p<0||p>65535)return}h(s,r);break;default:return}},[c,t,h]);m(s=>x(s.target),[x]);const{selectChartStyleIndex:M,updateAppConfig:y}=H(),A=m(s=>{const r=s.target,{name:p,value:N}=r;switch(p){case"port":case"socks-port":case"mixed-port":case"redir-port":{const C=parseInt(N,10);if(C<0||C>65535)return;t(v(c,{[p]:C}));break}case"latencyTestUrl":{y(p,N);break}default:throw new Error(`unknown input name ${p}`)}},[c,t,y]),B=ke(()=>{const s=o.mode;return typeof s=="string"&&s[0].toUpperCase()+s.slice(1)},[o.mode]),[D,O]=J(X),{t:g,i18n:w}=W();return e.jsxs("div",{children:[e.jsx(K,{title:g("Config")}),e.jsxs("div",{className:d.root,children:[e.jsxs("div",{children:[e.jsx("div",{className:d.label,children:g("Mode")}),e.jsx(b,{options:Ie,selected:B,onChange:s=>x({name:"mode",value:s.target.value})})]}),e.jsxs("div",{children:[e.jsx("div",{className:d.label,children:g("LogLevel")}),e.jsx(b,{options:we,selected:o["log-level"],onChange:s=>x({name:"log-level",value:s.target.value})})]}),e.jsxs("div",{children:[e.jsx("div",{className:d.label,children:g("allow_lan_mixed")}),e.jsx("div",{className:d.wrapSwitch,children:e.jsx(Q,{name:"allow-lan",checked:o["allow-lan"],onChange:f})})]})]}),e.jsx("div",{className:d.sep,children:e.jsx("div",{})}),e.jsxs("div",{className:d.section,children:[e.jsxs("div",{children:[e.jsx("div",{className:d.label,children:g("latency_test_url")}),e.jsx(le,{name:"latencyTestUrl",type:"text",value:l,onBlur:A})]}),e.jsxs("div",{children:[e.jsx("div",{className:d.label,children:g("lang")}),e.jsx("div",{children:e.jsx(b,{options:Ne,selected:w.language,onChange:s=>w.changeLanguage(s.target.value)})})]}),e.jsxs("div",{children:[e.jsx("div",{className:d.label,children:g("chart_style")}),e.jsx(fe,{OptionComponent:ve,optionPropsList:ye,selectedIndex:n,onChange:M})]}),e.jsx("div",{className:d.item,children:e.jsx(te,{label:g("dark_mode_pure_black_toggle_label"),id:"dark-mode-pure-black-toggle",checked:D,onChange:s=>O(s.target.checked)})})]})]})}export{De as default};
