import{j as t,s as D,k as y,c as U,b as u,l as A,n as k,o as x,q as V,e as L,t as P,h as $,v as z,w as B,x as _,y as G,u as q,C as H,z as J,A as W,D as F}from"./index-d24422b3.js";import{r as K}from"./logs-70d9f4d5.js";import{S}from"./Select-2d669a60.js";const{useState:Q,useRef:X,useEffect:Y,useCallback:Z}=y;function ee({value:e,...a}){const[o,c]=Q(e),s=X(e);Y(()=>{s.current!==e&&c(e),s.current=e},[e]);const r=Z(h=>c(h.target.value),[c]);return t("input",{className:D.input,value:o,onChange:r,...a})}const te="_root_165du_1",ne="_section_165du_2",ae="_wrapSwitch_165du_26",se="_sep_165du_32",le="_label_165du_45",d={root:te,section:ne,wrapSwitch:ae,sep:se,label:le},oe="_fieldset_1ghjp_1",ce="_input_1ghjp_9",re="_cnt_1ghjp_9",b={fieldset:oe,input:ce,cnt:re};function ie({OptionComponent:e,optionPropsList:a,selectedIndex:o,onChange:c}){const s=U("visually-hidden",b.input),r=h=>{c(h.target.value)};return t("fieldset",{className:b.fieldset,children:a.map((h,p)=>u("label",{children:[t("input",{type:"radio",checked:o===p,name:"selection",value:p,"aria-labelledby":"traffic chart type "+p,onChange:r,className:s}),t("div",{className:b.cnt,children:t(e,{...h})})]},p))})}const{useMemo:de}=y,ue={plugins:{legend:{display:!1}},scales:{x:{display:!1,type:"category"},y:{display:!1,type:"linear"}}},O=[23e3,35e3,46e3,33e3,9e4,68e3,23e3,45e3],he=[184e3,183e3,196e3,182e3,19e4,186e3,182e3,189e3],pe=O;function ge({id:e}){const a=A.read(),o=de(()=>({labels:pe,datasets:[{...k,...x[e].up,data:O},{...k,...x[e].down,data:he}]}),[e]),c="chart-"+e;return V(a.Chart,c,o,null,ue),t("div",{style:{width:100,padding:5},children:t("canvas",{id:c})})}const{useEffect:R,useState:fe,useCallback:g,useRef:me,useMemo:Ce}=y,ve=[{id:0},{id:1},{id:2},{id:3}],_e=[["debug","Debug"],["info","Info"],["warning","Warning"],["error","Error"],["silent","Silent"]],Se=[["zh","中文"],["en","English"]],be=[["Global","Global"],["Rule","Rule"],["Direct","Direct"]],ye=e=>({configs:P(e),apiConfig:$(e)}),we=e=>({selectedChartStyleIndex:W(e),latencyTestUrl:F(e),apiConfig:$(e)}),Ie=L(we)(ke),Oe=L(ye)(Ne);function Ne({dispatch:e,configs:a,apiConfig:o}){return R(()=>{e(z(o))},[e,o]),t(Ie,{configs:a})}function ke({dispatch:e,configs:a,selectedChartStyleIndex:o,latencyTestUrl:c,apiConfig:s}){const[r,h]=fe(a),p=me(a);R(()=>{p.current!==a&&h(a),p.current=a},[a]),g(()=>{e(B("apiConfig"))},[e]);const f=g((n,l)=>{h({...r,[n]:l})},[r]),j=g(n=>{const l="allow-lan",i=n;f(l,i),e(_(s,{"allow-lan":i}))},[s,e,f]),C=g(({name:n,value:l})=>{switch(n){case"mode":case"log-level":f(n,l),e(_(s,{[n]:l})),n==="log-level"&&K({...s,logLevel:l});break;case"redir-port":case"socks-port":case"mixed-port":case"port":if(l!==""){const i=parseInt(l,10);if(i<0||i>65535)return}f(n,l);break;default:return}},[s,e,f]);g(n=>C(n.target),[C]);const{selectChartStyleIndex:E,updateAppConfig:w}=G(),M=g(n=>{const l=n.target,{name:i,value:N}=l;switch(i){case"port":case"socks-port":case"mixed-port":case"redir-port":{const v=parseInt(N,10);if(v<0||v>65535)return;e(_(s,{[i]:v}));break}case"latencyTestUrl":{w(i,N);break}default:throw new Error(`unknown input name ${i}`)}},[s,e,w]),T=Ce(()=>{const n=r.mode;return typeof n=="string"&&n[0].toUpperCase()+n.slice(1)},[r.mode]),{t:m,i18n:I}=q();return u("div",{children:[t(H,{title:m("Config")}),u("div",{className:d.root,children:[u("div",{children:[t("div",{className:d.label,children:"Mode"}),t(S,{options:be,selected:T,onChange:n=>C({name:"mode",value:n.target.value})})]}),u("div",{children:[t("div",{className:d.label,children:"Log Level"}),t(S,{options:_e,selected:r["log-level"],onChange:n=>C({name:"log-level",value:n.target.value})})]}),u("div",{children:[t("div",{className:d.label,children:m("allow_lan_mixed")}),t("div",{className:d.wrapSwitch,children:t(J,{name:"allow-lan",checked:r["allow-lan"],onChange:j})})]})]}),t("div",{className:d.sep,children:t("div",{})}),u("div",{className:d.section,children:[u("div",{children:[t("div",{className:d.label,children:m("latency_test_url")}),t(ee,{name:"latencyTestUrl",type:"text",value:c,onBlur:M})]}),u("div",{children:[t("div",{className:d.label,children:m("lang")}),t("div",{children:t(S,{options:Se,selected:I.language,onChange:n=>I.changeLanguage(n.target.value)})})]}),u("div",{children:[t("div",{className:d.label,children:m("chart_style")}),t(ie,{OptionComponent:ge,optionPropsList:ve,selectedIndex:o,onChange:E})]})]})]})}export{Oe as default};
