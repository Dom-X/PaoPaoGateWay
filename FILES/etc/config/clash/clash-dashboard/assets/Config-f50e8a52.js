import{j as e,s as T,h as _,c as U,i as D,k as w,l as I,n as V,d as N,o as A,g as k,q as P,t as z,v as j,w as B,u as G,C as q,x as H,y as J,z as W}from"./index-dcea5d2f.js";import{r as F}from"./logs-9e380b83.js";import{S as C}from"./Select-29e929fc.js";const{useState:K,useRef:Q,useEffect:X,useCallback:Y}=_;function Z({value:t,...n}){const[o,c]=K(t),a=Q(t);X(()=>{a.current!==t&&c(t),a.current=t},[t]);const r=Y(u=>c(u.target.value),[c]);return e.jsx("input",{className:T.input,value:o,onChange:r,...n})}const ee="_root_165du_1",te="_section_165du_2",se="_wrapSwitch_165du_26",ne="_sep_165du_32",ae="_label_165du_45",d={root:ee,section:te,wrapSwitch:se,sep:ne,label:ae},le="_fieldset_1ghjp_1",oe="_input_1ghjp_9",ce="_cnt_1ghjp_9",v={fieldset:le,input:oe,cnt:ce};function re({OptionComponent:t,optionPropsList:n,selectedIndex:o,onChange:c}){const a=U("visually-hidden",v.input),r=u=>{c(u.target.value)};return e.jsx("fieldset",{className:v.fieldset,children:n.map((u,p)=>e.jsxs("label",{children:[e.jsx("input",{type:"radio",checked:o===p,name:"selection",value:p,"aria-labelledby":"traffic chart type "+p,onChange:r,className:a}),e.jsx("div",{className:v.cnt,children:e.jsx(t,{...u})})]},p))})}const{useMemo:ie}=_,de={plugins:{legend:{display:!1}},scales:{x:{display:!1,type:"category"},y:{display:!1,type:"linear"}}},L=[23e3,35e3,46e3,33e3,9e4,68e3,23e3,45e3],ue=[184e3,183e3,196e3,182e3,19e4,186e3,182e3,189e3],pe=L;function he({id:t}){const n=D.read(),o=ie(()=>({labels:pe,datasets:[{...w,...I[t].up,data:L},{...w,...I[t].down,data:ue}]}),[t]),c="chart-"+t;return V(n.Chart,c,o,null,de),e.jsx("div",{style:{width:100,padding:5},children:e.jsx("canvas",{id:c})})}const{useEffect:R,useState:ge,useCallback:h,useRef:fe,useMemo:xe}=_,me=[{id:0},{id:1},{id:2},{id:3}],je=[["debug","Debug"],["info","Info"],["warning","Warning"],["error","Error"],["silent","Silent"]],Ce=[["zh","中文"],["en","English"]],ve=[["Global","Global"],["Rule","Rule"],["Direct","Direct"]],_e=t=>({configs:A(t),apiConfig:k(t)}),Se=t=>({selectedChartStyleIndex:J(t),latencyTestUrl:W(t),apiConfig:k(t)}),ye=N(Se)(we),Le=N(_e)(be);function be({dispatch:t,configs:n,apiConfig:o}){return R(()=>{t(P(o))},[t,o]),e.jsx(ye,{configs:n})}function we({dispatch:t,configs:n,selectedChartStyleIndex:o,latencyTestUrl:c,apiConfig:a}){const[r,u]=ge(n),p=fe(n);R(()=>{p.current!==n&&u(n),p.current=n},[n]),h(()=>{t(z("apiConfig"))},[t]);const g=h((s,l)=>{u({...r,[s]:l})},[r]),$=h(s=>{const l="allow-lan",i=s;g(l,i),t(j(a,{"allow-lan":i}))},[a,t,g]),x=h(({name:s,value:l})=>{switch(s){case"mode":case"log-level":g(s,l),t(j(a,{[s]:l})),s==="log-level"&&F({...a,logLevel:l});break;case"redir-port":case"socks-port":case"mixed-port":case"port":if(l!==""){const i=parseInt(l,10);if(i<0||i>65535)return}g(s,l);break;default:return}},[a,t,g]);h(s=>x(s.target),[x]);const{selectChartStyleIndex:E,updateAppConfig:S}=B(),O=h(s=>{const l=s.target,{name:i,value:b}=l;switch(i){case"port":case"socks-port":case"mixed-port":case"redir-port":{const m=parseInt(b,10);if(m<0||m>65535)return;t(j(a,{[i]:m}));break}case"latencyTestUrl":{S(i,b);break}default:throw new Error(`unknown input name ${i}`)}},[a,t,S]),M=xe(()=>{const s=r.mode;return typeof s=="string"&&s[0].toUpperCase()+s.slice(1)},[r.mode]),{t:f,i18n:y}=G();return e.jsxs("div",{children:[e.jsx(q,{title:f("Config")}),e.jsxs("div",{className:d.root,children:[e.jsxs("div",{children:[e.jsx("div",{className:d.label,children:"Mode"}),e.jsx(C,{options:ve,selected:M,onChange:s=>x({name:"mode",value:s.target.value})})]}),e.jsxs("div",{children:[e.jsx("div",{className:d.label,children:"Log Level"}),e.jsx(C,{options:je,selected:r["log-level"],onChange:s=>x({name:"log-level",value:s.target.value})})]}),e.jsxs("div",{children:[e.jsx("div",{className:d.label,children:f("allow_lan_mixed")}),e.jsx("div",{className:d.wrapSwitch,children:e.jsx(H,{name:"allow-lan",checked:r["allow-lan"],onChange:$})})]})]}),e.jsx("div",{className:d.sep,children:e.jsx("div",{})}),e.jsxs("div",{className:d.section,children:[e.jsxs("div",{children:[e.jsx("div",{className:d.label,children:f("latency_test_url")}),e.jsx(Z,{name:"latencyTestUrl",type:"text",value:c,onBlur:O})]}),e.jsxs("div",{children:[e.jsx("div",{className:d.label,children:f("lang")}),e.jsx("div",{children:e.jsx(C,{options:Ce,selected:y.language,onChange:s=>y.changeLanguage(s.target.value)})})]}),e.jsxs("div",{children:[e.jsx("div",{className:d.label,children:f("chart_style")}),e.jsx(re,{OptionComponent:he,optionPropsList:me,selectedIndex:o,onChange:E})]})]})]})}export{Le as default};
